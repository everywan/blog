= HLL
HLL 即 HyperLogLog, 是一种基数基数的方法.

参考 link:https://juejin.im/post/6844903785744056[HyperLogLog]

数学原理: 概率论, 伯努利实验.

标准误差 0.81, 实验次数越多, 实验概率越随机, 准确率越高.

原理:

.伯努利实验
1. 抛硬币, 每次正反面出现概率相同.
2. 假设每次实验都抛十次硬币, 则出现全部是正面的概率是 `1/2^10` .

HLL 核心思想就是, 根据结果的最小概率情况, 推测实验次数.
如上述实验, 如果出现了 _抛十次硬币, 全为正面_, 则可以估测实验次数是 `2^10` 次.

类推到 redis hll 实现.

redis hll 内部将存储分为 `2^14` 个桶, 每个桶有6bit.

redis 将每个传入的值hash为64位, 前14位用于确定分桶, 后50位确定桶内值, 后50位是hll概率统计的关键.

.算法流程简介如下
. 假设前14位是 000...11, 则划分到第三个桶.
. 假设 value 的后50位中, 第一次出现1的位置是第50位, 则将第三桶的6bit值设置为 110010(50的二进制表示).
. 海量实验后, 用户触发一次统计
  .. 根据每个桶中出现1的位置, 估算该桶的访问总量. 如桶3, value=50, 则可以估算试验次数为 `2^50` 次, 即统计到的访问量/数据插入总量为 `2^50` 个.
  .. 将每个桶作为一个样本, 通过计算所有桶的平均值(一般使用调和平均值), 估算总访问总量.

.由流程可知, hll实现的关键在于, 程序认为hash后value的值是随机的.
. 前14位是随机的才能保证均分到不同的桶中.
. 后50位是随机的才能保证 _使用概率估算实验次数_ 的可靠性, 因为是将1出现的首次位置作为概率分布的.

具体的算法/公式会有所修正, 但大概的思路是如此的.

.根据原理, hll适合如下类型的统计
1. 数据点分布随机, 或者hash后分布随机.
2. 允许误差, 不要求准确的统计.

