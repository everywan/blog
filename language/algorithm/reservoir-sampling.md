# Reservoir Sampling 蓄水池抽样算法

题目: 从数据流中抽取k个元素, 要求每个元素都是随机取出的.

场景: 在实际应用中, 往往会遇到很大数据流的情况. 因此, 我们无法先保存整个数据流然后再从中选取, 而是期望有一种将数据流遍历一遍就得到所选取的元素, 并且保证得到的元素是随机的算法.

算法的目标是保证每个元素被取出的概率为 `k/n`, 根据这个目标, 算法原理如下
1. 从流中取出前 k 个元素.
2. 假设第 k 个之后的元素为 i, 对于元素i, 以概率 `p=k/k+i` 决定是否将 元素i 置入数据集. 如果留下i, 则从 k 个元素中随机选一个元素置换为i.
3. 重复 1/2, 直到 `k+i==n`, 即数据流的最新数据.

证明如下
````
假设 l 为k中的某一元素

当i==1时:
  p(i选中) = k/(k+1)
  p(l选中) = 1/(k+1) + k/(k+1) * (k-1)/k = k/(k+1)

当i==?时:
  p(i) = k/(k+i)
  p(l) = k/(k+i-1) * ( i/(k+i) + k/(k+i) * (k-1)/k ) = k/(k+i)

其中, k/(k+i-1) 是指上一轮中, l 还在数据集 k 中的概率, 自然, 其中已经包含了上上一轮, 上上上一轮等等中 l 存活的概率
````

思考这个问题时, 经常走入如下误区
1. 由于数据源是流, 所以每流出一个元素, 已取出的数据的概率就会改变, 所以整个取出的数据集是动态变化的, 而不是固定的.
2. 思考已取出的元素对下一次取出所造成的影响.

参考: [蓄水池抽样-果壳](https://www.guokr.com/blog/745588/)
