<!-- TOC -->

- [一致性](#一致性)
    - [Quorum系统NRW策略](#quorum系统nrw策略)
    - [两阶段提交算法](#两阶段提交算法)
    - [Paxos算法](#paxos算法)
    - [Raft算法](#raft算法)
    - [引用](#引用)

<!-- /TOC -->

## 一致性
通过CAP理论可知, 在设计一个分布式系统时, 只能满足 一致性, 可用性, 分区容忍性 的两点. 但是因为网络分区是非人为控制的, 所以设计师要在一致性和可用性之间做出抉择.
- 建议在看一致性之前, 先了解下 [cap定律和base理论](/application/distributed_system/cap_base.md), 在讨论任何分布式系统时, CAP总是核心的需求.

本文所讲的是, 在分布式系统中, 一致性有那些级别, 分布式系统的一致性与其他编程领域的一致性有什么区别, 以及分布式系统的一致性有哪些方式实现

一致性按照种类划分有三种, 分别是
- 强一致性: 任意时刻, 所有节点的数据都是相同的.
- 弱一致性: 任意时刻, 所有节点的数据不一定都是相同的. 弱一致性有很多不同的实现, 分布式系统中常用的是最终一致性.
- 最终一致性: 最终一致性保证两点: 保证用户最终能够读取到数据最新状态的值; 保证不同节点上的相同的数据总在趋向于变得一致.

按照不同领域, 事务中所指的一致性与分布式系统所指的一致性又有所不同, 事务的一致性关注 事务执行的中间状态是否对外界可见, 分布式系统的一致性着重于多个节点的值保持相同. 但是, 数据库中 CAP 所指的一致性与分布式系统中的一致性基本相同.
- 具体参考 [事务-一致性](/application/database/basics/transaction.md#一致性)

最后, 我们讲讲分布式系统中的一致性有哪些实现. 首先是最基础的 Quorum机制.

### Quorum系统NRW策略
NRW策略是强一致性算法, 性能较最终一致性算法的系统低.

Quorum机制, 是分布式系统中一种保证数据冗余和最终一致性的算法, 主要思想来源于 鸽巢原理
- 鸽巢原理: 若有N个笼子和N+1只鸽子, 所有的鸽子都关在笼子里, 那么至少有一个笼子里有两个鸽子. 

NRW策略, 解释如下:
- N: 数据拥有的副本数
- R: 完成读操作所需要读取的最小副本数. 即一次读操作所需要参与的最小节点数目.
- W: 完成写操作所需要写入的最小副本数. 即一次写操作所需要参与的最小节点数目.

NRW策略, 就是指: 只要保证 `R+W>N`, 就可以保证强一致性. 即在 N 个副本中, 有 R 个更新到最新的数据, 那么 读取任意大于 N-R 的副本, 总有副本是最新的数据(更新数据时, 同样更新版本/时间戳标记, 使用标记判断读取的 `>N-R` 个副本中, 那些是最新的数据.)

当 R+W>N 时, 那么分布式系统是 强一致性 的系统.

当 R+W<=N 时, 分布式系统是 弱一致性 的系统, 是否能实现 最终一致性 取决于系统异步更新的实现方式.

R W 可以根据系统的特点进行合理的设置, 比如一下特例
1. W=1, R=N: 每次只需写入等待一个节点返回正常写入的回应即可, 读取时读取全部节点的数据. 适合写入操作很多, 但读取操作很少的系统. 但是若有一个节点故障, 则读操作无法完成.
2. W=N, R=1: 与 1 相反.
3. W=R=N/2+1: 均衡上面两个情况

### 两阶段提交算法

### Paxos算法

### Raft算法

### 引用
- [浅析数据一致性](http://www.importnew.com/20633.html)
- [Paxos算法的通俗理解](https://www.cnblogs.com/yeahwell/p/4703219.html)
- [Raft 算法(Raft 论文翻译)](http://blog.51cto.com/liuxp0827/1899354)
