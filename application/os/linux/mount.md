<!-- TOC -->

- [挂载 分区和格式化](#挂载-分区和格式化)
    - [分区](#分区)
        - [Linux 分区操作](#linux-分区操作)
    - [格式化](#格式化)
    - [挂载](#挂载)

<!-- /TOC -->

# 挂载 分区和格式化

## 分区
1. 硬盘的格式
    - IDE并行接口: `/dev/hd[a-z]`, hdc表示光驱设备
    - SATA串行端口: `/dev/sd[a-z]`,  其他 SCSI, SAS, SATA, USB 等也被识别为 `/dev/sd[a-z]`
2. 分区:
    - 一块硬盘上 主分区+扩展分区 的个数最多为4个, 其中的逻辑分区可以创建N个逻辑分区

### Linux 分区操作
> fdisk命令必须时root账户才能操作  
> [参考](http://litaotao.blog.51cto.com/6224470/1253401): 如果时间充裕的话, 教程略看即可. 建议看命令的help文档或者直接翻源码去

1. 'fdisk -l'： 查看所有的硬盘设备
    - 'fdisk -l /dev/sda` : 查看特定设备
2. `fdisk /dev/sda`: 对`/dev/sda`硬盘进行操作(可以是分区, 也可以是整块硬盘)
    - 根据选项解释进行操作即可
    - p: 打印分区表,   n: 新建分区,  l: 列出已知分区类型列表,  t: 更改分区类型,  d: 删除分区
    - w: 保存&&退出,    q: 不保存&&退出
3. 分区完成后内核并不能立即识别分区的信息, 需要以下操作
    - `cat /proc/partitions`: 查看内核识别的分区信息
    - `partprobe /dev/sda | partx -a /dev/sda1 /dev/sda`: 让内核重新读取硬件分区表

## 格式化
1. 分好区后的分区并不能直接挂载, 需要先格式化
2. `mkfs -t ext4  /dev/sda1`: 将 `/dev/sda1` 格式化为 ext4 类型分区
    - `-b`: 指定块的大小, 可取值`{1024|2048|4096byte}`. 块大小取决cpu对内存页框大小的支持, x86系统默认页大小是4096==4k
    - `-L`: label 设定卷标
    - `-m`: 预留给管理使用的块所占的比率. 一般用在分区很大的时候
3. 有兴趣/时间可以研究下 `mke2fs && tune2fs`
    - tune2fs: 查看分区的详细信息

## 挂载
> 必须有挂载目录, 否则无法挂载   
> 如果挂载目录里有内容, 那么挂载硬盘后将会显示硬盘里的内容. 原目录内容只有在umount后才显示

1. mount 挂载
    ````
    fdsik -l  # 查看挂载的硬盘
    mkdir /data1  # 创建挂载点
    mount /dev/sda1 /data1 # 挂载
    ````
2. umount 卸载
    - `umount /dev/sda1`: 卸载
    - `umount -l /dev/sda1`: 采用lazy模式卸载
        - 立即从目录结构中实现卸载, 即新进程将无法通过/data1访问/dev/sda1
        - 正在访问该文件系统的程序不受影响. 即正在操作/data1的进程不会被打断, 且仍可以读写/dev/sda1中的所有文件. 
        - 如果所有进程对/data1的操作都执行完, 那么才真正地umount
        - lazy umount并没有真正实现umount, 仅用于特殊需要的情况, 而用这种方法来卸载U盘是不安全的
3. fuser 查找使用挂载点的程序,kill后可卸载外设
    ````
    fuser -m /data1
    kill id
    ````
4. 开机挂载硬盘
    - `/etc/fstab`配置文件 被用来管理硬盘的开机自动挂载
    - 配置项共六列, 如下

        |file system|   mount point|   type|  options|  dump|  pass|
        |:----:|:----:|:----:|:----:|:----:|:----:|
        a:设备名   |b:文件系统挂载点  |c: 文件系统类型  |d:mount命令选项    |e:转储文件系统   |f：文件系统检查
        /dev/sda1   |/data  |ext4  |rw    |0   |2
    - d: mount命令选项. mount选项包括noauto(不挂载), ro(只读挂载), rw(读写挂载). 在该字段里添加用户或属主选项, 即可允许该用户挂载文件系统. 多个选项之间必须用逗号隔开. 其他选项的相关信息可参看mount命令手册页（-o选项处）
    - e 转储文件系统. 该字段只在用dump备份时才有意义. 数字1表示该文件系统需要转储, 0表示不需要转储
    - f 文件系统检查. 该字段里的数字表示文件系统是否需要用fsck检查. 0表示不必检查该文件系统, 数字1示意该文件系统需要先行检查（用于根文件系统）. 数字2则表示完成根文件系统检查后, 再检查该文件系统
5. `df -hl`: 查看是否挂载成功
6. 具体实践请看 [Linux下安装Mapd](/application/database/mapd/InstallMapd.md): 其中有部分在TX2上安装Mapd用到了分区
